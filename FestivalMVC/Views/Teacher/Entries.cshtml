@model FestivalMVC.ViewModels.EntryViewModel
@{
    ViewBag.Title = "Entries";
    Layout = "~/Views/Teacher/_TeacherLayout.cshtml";
}

<form id="__AjaxAntiForgeryForm">
    @Html.AntiForgeryToken()
</form>

<div class="well">
    <div class="text-center">
        @{ bool closed = false;
            if (!Model.EventVM.ComputeIfOpen())
            {
                closed = true;
                <h3>Registration is closed. No more entries or changes will be accepted.</h3>
            }
            else
            {
                int daysLeft = (int)Math.Truncate((Model.EventVM.Event.CloseDate - DateTime.Today).TotalDays);
                if (daysLeft == 1)
                {
                    int hoursLeft = (int)Math.Truncate((Model.EventVM.Event.CloseDate - DateTime.Today).TotalHours);
                    <h2>@($"There are less than {hoursLeft} hours remaining to complete your entries!")</h2>
                }
                <h3>@($"There are less than {daysLeft} days remaining to complete your entries.")</h3>
            }

        }
    </div>
    <div class="row">
        <div class="col-sm-12">

            <ul class="nav nav-tabs">
                @{ string first = "active";
                    foreach (var classtype in Model.ClassTypes)
                    {
                        <li class="@first"><a data-toggle="tab" href="@($"#tab{classtype.ClassType}")">@classtype.TypeName</a></li>
                        first = "";
                    }
                }
            </ul>
            <div class="tab-content">
                @{ first = "in active";
                    foreach (var classtype in Model.ClassTypes)
                    {
                        <div id="@($"tab{classtype.ClassType}")" class="tab-pane fade @first" data-classType="@Json.Encode(classtype)">
                            <table id="@($"table{classtype.ClassType}")" class="table-condensed">
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>Class</th>
                                        <th>Required Piece</th>
                                        @if (classtype.RequiresChoicePiece)
                                        {
                                            <th>Choice Piece</th>
                                        }
                                        @if (classtype.RequiresAccomp)
                                        {
                                            <th>Accompanist</th>
                                        }
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var entry in Model.EntriesByClassType(classtype.ClassType))
                                    {
                                        <tr name="@entry.EntryBase.Id" data-entry="@Json.Encode(entry)"
                                            onclick="EntriesApp.editEntry($(this).data('entry'),$(this).closest('div.tab-pane').data('classType'))">
                                            <td>@entry.StudentName</td>

                                            <td class="text-center"><span class="label label-fixed label-warning"> @entry.EntryBase.ClassAbbr</span></td>
                                            <td name="req">@entry.RequiredPieceDesc</td>
                                            @if (classtype.RequiresChoicePiece)
                                            {
                                                <td name="choice">@entry.ChoicePieceDesc</td>
                                            }
                                            @if (classtype.RequiresAccomp)
                                            {
                                                <td name="acc">@entry.EntryDetails.Accompanist</td>
                                            }
                                            <td name="notes">@entry.EntryDetails.Notes</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        first = "";
                    }

                }
            </div>
        </div>
    </div>
</div>


@{if (!closed)
    {
        <form id="entryForm">
            <div class="modal fade" id="entryModal" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="well-sm">
                            <div class="row">
                                <div class="col-sm-4">
                                    <input name="Id" type="hidden" class="form-control" />
                                    <div class="form-group">
                                        <label class="control-label" for="StudentName">Student Name:</label>
                                        <input name="StudentName" class="form-control" readonly />
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label" for="RequiredPiece">Required Piece:</label>
                                        <select name="RequiredPiece" class="form-control" onchange="EntriesApp.onRequiredChange()" required></select>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label" for="RequiredExtension">Movement:</label>
                                        <select name="RequiredExtension" class="form-control" required></select>
                                    </div>

                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group optional-hide">
                                        <label class="control-label" for="ChoicePiece">Choice Piece:</label>
                                        <input name="ChoicePiece" class="form-control" required maxlength="50"/>
                                    </div>
                                    <div class="form-group optional-hide">
                                        <label class="control-label" for="ChoiceComposer">Choice Composer:</label>
                                        <input name="ChoiceComposer" class="form-control" required maxlength="50"/>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="Publisher">Publisher:</label>
                                        <input name="Publisher" class="form-control" required maxlength="20"/>
                                    </div>
                                    <div class="form-group optional-show">
                                        <label class="control-label" for="Accompanist">Accompanist:</label>
                                        <input name="Accompanist" class="form-control" required maxlength="50"/>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="Notes">Notes:</label>
                                        <input name="Notes" class="form-control" maxlength="50"/>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <a class="btn btn-default" onclick="$('#entryModal').modal('hide')" title="Close">Close</a>
                                        <a class="btn btn-default" onclick="EntriesApp.updateEntry()" title="Save">Save</a>
                                    </div>
                                    <div class="alert alert-danger" name="submitError">
                                        <strong>Server error! </strong><span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    }
}
<div class="modal fade" id="infoModal" role="dialog">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Modal Header</h4>
            </div>
            <div class="modal-body">
                <p>This is a small modal.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">OK</button>
            </div>

        </div>
    </div>
</div>
<script>


</script>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/Scripts/FestivalLib.js")
    @Scripts.Render("~/Scripts/Entries.js")
}
